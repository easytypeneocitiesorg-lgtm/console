<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Custom Console</title>
<style>
  body { background: #111; color: #0f0; font-family: monospace; margin:0; }
  #console { width: 100%; height: 100vh; padding: 10px; box-sizing: border-box; overflow-y: auto; }
  input { width: 100%; background: #111; color: #0f0; border: none; outline: none; font-family: monospace; font-size: 16px; }
  #saveModal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#222; padding:20px; border:2px solid #0f0; }
  #saveModal input { width: 100%; margin-top:10px; }
</style>
</head>
<body>

<div id="console"></div>
<input id="commandInput" placeholder="Type a command..." autocomplete="off">

<div id="saveModal">
  <div>Enter file name:</div>
  <input id="filenameInput">
  <button onclick="saveFile()">Save</button>
</div>

<script>
const consoleDiv = document.getElementById('console');
const input = document.getElementById('commandInput');
const saveModal = document.getElementById('saveModal');
const filenameInput = document.getElementById('filenameInput');

let files = {};  // stores all files and their code
let currentFile = null;
let currentCommands = {}; // stores custom commands for current file
let counter = 0;
let counterInterval = null;
let counterPaused = false;

function log(msg) {
  consoleDiv.innerHTML += msg + "<br>";
  consoleDiv.scrollTop = consoleDiv.scrollHeight;
}

function showHelp() {
  log("/help - show this help");
  log("/new - create a new file");
  log("/run filename - run a file");
  log("/exit - exit current file");
}

function openNewFile() {
  currentFile = { code: "", commands: {} };
  currentCommands = currentFile.commands;
  log("Editing new file. Type code below:");
  input.placeholder = "Type your code here...";
  input.focus();
}

function saveFile() {
  const name = filenameInput.value.trim();
  if(name) {
    files[name] = currentFile;
    currentFile = null;
    currentCommands = {};
    saveModal.style.display = 'none';
    input.placeholder = "Type a command...";
    log(`File '${name}' saved.`);
  }
}

function runFile(name) {
  if(!files[name]) {
    log(`File '${name}' not found.`);
    return;
  }
  const file = files[name];
  currentFile = file;
  currentCommands = file.commands;
  log(`Running file '${name}'...`);
  executeCode(file.code);
}

function executeCode(code) {
  const lines = code.split("\n");
  for(let line of lines) {
    line = line.trim();
    if(line.startsWith("if run")) {
      // execute immediately
      const cmd = line.replace("if run", "").trim();
      runCustomCommand(cmd);
    }
    else if(line.startsWith("command ")) {
      const parts = line.split(" ");
      const cmdName = parts[1];
      const cmdCode = line.substring(line.indexOf("{")+1, line.lastIndexOf("}")).trim();
      currentCommands[cmdName] = cmdCode;
    }
    else if(line.startsWith("loop counter")) {
      startCounter();
    }
  }
}

function startCounter() {
  if(counterInterval) clearInterval(counterInterval);
  counterInterval = setInterval(()=>{
    if(!counterPaused) {
      counter++;
    }
  }, 1000);
}

function runCustomCommand(name) {
  if(currentCommands[name]) {
    executeCode(currentCommands[name]);
  } else {
    log(`Command '${name}' not found in this file.`);
  }
}

input.addEventListener("keydown", e=>{
  if(e.key === "Enter") {
    const cmd = input.value.trim();
    input.value = "";
    
    if(cmd === "/help") showHelp();
    else if(cmd === "/new") saveCurrentAndNew();
    else if(cmd.startsWith("/run ")) {
      const name = cmd.split(" ")[1];
      runFile(name);
    }
    else if(cmd === "/exit") {
      currentFile = null;
      currentCommands = {};
      log("Exited current file.");
    }
    else if(currentFile && currentCommands[cmd]) {
      runCustomCommand(cmd);
    }
    else {
      if(currentFile) {
        currentFile.code += cmd + "\n";
      } else {
        log(`Unknown command: ${cmd}`);
      }
    }
  }
});

function saveCurrentAndNew() {
  if(currentFile) {
    saveModal.style.display = 'block';
    filenameInput.value = "";
    filenameInput.focus();
  } else {
    openNewFile();
  }
}

// initial
log("Welcome to the Custom Console!");
showHelp();

</script>
</body>
</html>
